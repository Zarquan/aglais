#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2020, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#

    Rough notes on deploying the Kubernetes dashboard.
    Proxy settings worked, but not reliably.

----------------------------------------------------------------------------
----------------------------------------------------------------------------


    kubectl \
        --kubeconfig "${HOME}/.kube/${clustername:?}/config" \
        apply \
            --filename https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml

    kubectl \
        --kubeconfig "${HOME}/.kube/${clustername:?}/config" \
        proxy \
            --address 0.0.0.0


    http://localhost:33577/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/


----------------------------------------------------------------------------
----------------------------------------------------------------------------


    https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/#accessing-the-dashboard-ui
    https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md


    cat > "${HOME}/dashboard/dashboard-adminuser.yaml" << EOF
---

apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kubernetes-dashboard

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard
EOF


    kubectl \
        --kubeconfig "${HOME}/.kube/${clustername:?}/config" \
        create \
            --filename "${HOME}/dashboard/dashboard-adminuser.yaml"


    kubectl \
        --kubeconfig "${HOME}/.kube/${clustername:?}/config" \
        -n kubernetes-dashboard describe secret $(kubectl --kubeconfig "${HOME}/.kube/${clustername:?}/config" -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}')

    >   Name:         admin-user-token-xjmv4
    >   Namespace:    kubernetes-dashboard
    >   Labels:       <none>
    >   Annotations:  kubernetes.io/service-account.name: admin-user
    >                 kubernetes.io/service-account.uid: b466f765-46b1-449c-805c-0f0056d8e8ba
    >   
    >   Type:  kubernetes.io/service-account-token
    >   
    >   Data
    >   ====
    >   token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLXhqbXY0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJiNDY2Zjc2NS00NmIxLTQ0OWMtODA1Yy0wZjAwNTZkOGU4YmEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.OhsTLObktHBpWot8Jxn-mf-oU-JC15aoUEHNDSqFjxllSyNn6ehWYLvGNkLzWUJJsRuviM__6tCql1DAuk6HZY6W2jL_AuWiz647fY4wCRT0jRNoEdr-1eLpLREYAYLwrin3QZ0lMLsV-DZKQmyPuOj9MU03NAGiVW1oP7r5CBGIo1PwRsv0qZxXCpIVA9_K_Z3iW8zYAfKi1Du3H1UBrqXwsOR22cPmIK1VyhvA_DiLP6dAFTKb4S54ENR0VEYbXIM8Ebr-YldBKjEhzzL4d1XSgNaWKwpgvT9Gxz4u1SeXAxKxnaURw46_igv0TAsyL2JrUqOG7m1cXbKv0pHVjQ
    >   ca.crt:     1046 bytes
    >   namespace:  20 bytes

